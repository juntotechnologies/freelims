# FreeLIMS Scripts

This directory contains scripts for managing the FreeLIMS project. All scripts are organized by their functionality.

## Main Script

The main script (`freelims.sh`) serves as the entry point for all operations. It provides a unified interface to manage different environments and components of the project.

### Usage

```
./freelims.sh [environment] [command]
```

Where:
- `environment` is one of: `dev`, `prod`, `db`, `setup`, or `all`
- `command` depends on the environment

For example:
```
./freelims.sh dev start    # Start the development environment
./freelims.sh prod status  # Check the status of the production environment
./freelims.sh db backup    # Create a database backup
./freelims.sh all status   # Show status of all services
./freelims.sh all start_both # Start both production and development environments
```

Run `./freelims.sh help` for complete documentation.

## Directory Structure

- **common/** - Common utility functions used by all scripts
- **dev/** - Scripts for managing the development environment
- **prod/** - Scripts for managing the production environment
- **db/** - Scripts for database operations
- **logs/** - Log files generated by the scripts (created at runtime)

## Environment Management

### Development Environment

The development environment scripts (`dev/manage.sh`) manage the local development setup.

Commands:
- `start` - Start the development environment
- `stop` - Stop the development environment
- `restart` - Restart the development environment
- `status` - Show the status of development services
- `logs` - Show development logs
- `clean` - Clean the development environment
- `fix` - Fix common development environment issues

Example:
```
./freelims.sh dev start
```

### Production Environment

The production environment scripts (`prod/manage.sh`) manage the production setup.

Commands:
- `start` - Start the production environment
- `stop` - Stop the production environment
- `restart` - Restart the production environment
- `status` - Show the status of production services
- `logs` - Show production logs
- `build` - Build the frontend for production
- `deploy` - Deploy the production environment

Example:
```
./freelims.sh prod deploy
```

### Database Management

The database management scripts (`db/manage.sh`) handle database operations.

Commands:
- `backup` - Create a database backup
- `restore` - Restore from a database backup
- `status` - Show the database status
- `migrate` - Run database migrations
- `create` - Create a new database
- `drop` - Drop the database
- `init` - Initialize the database with sample data

Example:
```
./freelims.sh db backup
```

### All Environments

The all environment commands operate on multiple environments simultaneously.

Commands:
- `start` - Start all environments
- `stop` - Stop all environments
- `restart` - Restart all environments
- `status` - Show status of all environments
- `start_both` - Start both production and development environments with consistent authentication

Example:
```
./freelims.sh all status
./freelims.sh all start_both
```

The `start_both` command is particularly useful for running both environments simultaneously with shared authentication. This will:
1. Stop any existing environments
2. Start the production environment (API on port 9000, frontend on port 3000)
3. Start the development environment (API on port 8000, frontend on port 3001)
4. Configure consistent authentication between the environments
5. Display access URLs for both environments

## Logs

All scripts generate log files in the `logs/` directory. You can view these logs using the `logs` command:

```
./freelims.sh dev logs
./freelims.sh prod logs
```

## Troubleshooting

If you encounter issues with the development environment, you can use the fix command:

```
./freelims.sh dev fix
```

This will attempt to fix common issues such as incorrect environment configurations, proxy settings, etc.

For database issues, check the database status:

```
./freelims.sh db status
```

## Contributing

When adding new scripts or modifying existing ones, please follow these guidelines:

1. Use the common utility functions defined in `common/utils.sh`
2. Implement comprehensive error handling
3. Log all actions with appropriate log levels
4. Add documentation in this README
5. Ensure all scripts are executable (`chmod +x filename.sh`)
6. Add proper argument validation and usage information